<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link  rel="stylesheet" href="../css/public.css">
</head>
<body>
    <div class="roomList">
		<div class="showList">
			<ul>
				<li v-for="roomInfo in roomInfos" :id="'room_'+roomInfo.room_id">
					<a :href="'room.html?room_id='+roomInfo.room_id+'&room_key='+roomInfo.room_key">{{roomInfo.room_name}}</a>
				</li>
			</ul>
		</div>
		<div id="getRoomListInfoButton" @click="getRoomListInfo">更新房间列表信息</div>
		<div id="createRoom" @click="createRoom">创建房间</div>
    </div>
	<script type="text/javascript" src="../js/vue.js"></script>
	<script type="text/javascript" src="../js/vue-resource.js"></script>
	<script type="text/javascript">
		//Html连接webSocket demo
//        var ws = new WebSocket("ws://localhost:6001");
//        ws.onopen = function (e) {
//            console.log('Connection to server opened');
//            ws.send('哈哈哈');
//        }
//        ws.onmessage = function(evt) {
//            console.log( "Received Message: " + evt.data);
//            ws.close();
//        };
		window.onload=function(){
		    document.getElementById("getRoomListInfoButton").click();
		}
		var roomList=new Vue({
		    el: '.roomList',
			data:{
		        roomInfos:[]
			},
		    methods:{
                getRoomListInfo: function() {
                    this.$http.get('../rooms/getRooms').then(response => {
                        if(response.body.code==200){
                            var data=response.body.data;
                            var roomAttr=[];
						    for(var i=0;i<data.length;i++){
                                roomAttr[i]={};
                                roomAttr[i].room_id=data[i].id;
                                roomAttr[i].room_key=data[i].key;
                                roomAttr[i].room_name=data[i].name;
							}
							this.roomInfos=roomAttr;
					    }
                    },response =>{
                        console.log(response)
					})
			    },
				createRoom:function(){
                    this.$http.get('../rooms/getRoom').then(response => {
                        if(response.body.code==200){
                        var data=response.body.data;
                        console.log(data)
						this.$http.jsonp('../rooms/comeIn',{params: {key: data.key}}).then(res=>{
						    console.log(res)
						},res=>{
						    console.log(res)
						})
//						window.location.href="room.html?room_id"+data.id+"&room_key="+data.key;
                        //Html连接webSocket demo
//                        var ws = new WebSocket("ws://localhost:"+data.key);
//                        ws.onopen = function (e) {
//                            console.log('Connection to server opened');
//                            ws.send('哈哈哈');
//                        }
//                        ws.onmessage = function(evt) {
//                            console.log( "Received Message: " + evt.data);
//                            ws.close();
//                        };
                    }
                },response =>{
                        console.log(response)
                    })
				}
		    }
		});
	</script>
</body>
</html>